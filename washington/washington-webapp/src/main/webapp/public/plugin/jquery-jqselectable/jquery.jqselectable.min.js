(function(a){var jQselectable=function(b,c,d){this.a={style:'selectable',set:'show',out:'hide',setDuration:'normal',outDuration:'normal',opacity:1,top:0,left:0,callback:null};this.b={selectable:'<div class="sctble_cont"/>',simpleBox:'<div class="simple_cont"/>'};a.extend(this.a,c||{});a.extend(this.b,d||{});this.c=a(b);this.d=0;this.e={id:this.c.attr('id'),cl:this.c.attr('class')};this.f=false;this.init()};jQselectable.prototype={init:function(){this.build();this.bind_events();this.generatedFlg=true},rebuild:function(){this.m_input.unbind();this.mat.unbind();a('a',this.mat).unbind();a('label[for="'+this.attrs.id+'"]').unbind();this.build();this.bind_events()},build:function(){var b=a('optgroup',this.target).length>0?true:false;var c=this;var generate_anchors=function(d,e){var f=a('<a/>');a(e).append(f);f.text(d.text()).attr({href:'#'+encodeURI(d.text()),name:d.val()});if(d.is(':selected')){c.m_text.text(d.text());f.addClass('selected')};if(d.hasClass('br')){f.after('<br/>')}};if(!this.m_input){this.m_input=a('<a/>');this.m_text=a('<span/>');var d=this.conf.style.match(/simple/)?'sBox':'sctble';this.m_input.append(this.m_text).attr({id:this.attrs.id+'_dammy',href:'#'}).addClass('sctble_display').addClass(d).addClass(this.attrs.cl).insertAfter(this.target);this.target.hide();this.mat=a('<div/>');if(d=='simple'){this.mat.append(this.temp.selectable)}else{this.mat.append(this.temp.simpleBox)};this.mat.attr({id:this.attrs.id+'_mat'}).addClass(d).addClass(this.attrs.cl)};if(this.generatedFlg){this.mat.empty();if(_style=='simple'){this.mat.append(this.temp.selectable)}else{this.mat.append(this.temp.simpleBox)}};this._div=a('<div class="body"/>');if(b){this.mat.addClass('otpgroup');var d=a('optgroup',this.target);var e=[];for(var f=0;f<d.length;f++){e[f]=a('option',d[f])};var g=a('<dl/>');for(var f=0;f<d.length;f++){var h=a('<dt/>');h.text(a(d[f]).attr('label'));var i=a('<dd/>');for(var j=0;j<e[f].length;j++){generate_anchors(a(e[f][j]),i)};g.append(h).append(i)};this._div.append(g).addClass('optg');a('div',this.mat).append(this._div)}else{this.mat.addClass('nooptgroup');var d=a('option',this.target);for(var e=0;e<d.length;e++){generate_anchors(a(d[e]),this._div)};a('div',this.mat).append(this._div.addClass('nooptg'))};if(!this.generatedFlg){a('body').append(this.mat);this.mat.addClass('sctble_mat').css({position:'absolute',zIndex:1000,display:'none'});a('*:first-child',this.mat).addClass('first-child');a('*:last-child',this.mat).addClass('last-child')};if(document.all&&typeof document.body.style.maxHeight=='undefined'){if(this.conf.height<this.mat.height()){a(this._div).css('height',this.conf.height)}}else{a(this._div).css('maxHeight',this.conf.height)};this.mat.show();this.matHeight=this.mat.attr('offsetHeight');this.mat.hide()},bind_events:function(){var b=this;var c=true;var set_pos=function(){var d,e=document.documentElement.scrollTop||document.body.scrollTop,f=document.documentElement.clientHeight||document.body.clientHeight,g=b.m_input.offset();if(f/2<(g.top-e)){d=g.top-b.matHeight+b.conf.top-5}else{d=g.top+b.m_input.height()*1.3+b.conf.top};b.mat.css({top:d,left:g.left+b.conf.left})};a(window).resize(function(){set_pos()});var mat_hide=function(){var d=a('.sctble_mat');switch(b.conf.out){case'slideUp':d.slideUp(b.conf.outDuration);break;case'fadeOut':d.fadeOut(b.conf.outDuration);break;default:d.hide();break}};var mat_show=function(){mat_hide();if(b.conf.set=='slideDown'){var f=document.documentElement.scrollTop||document.body.scrollTop,g=document.documentElement.clientHeight||document.body.clientHeight,h=b.m_input.offset(),i=g/2<(h.top-f);if(i){b.mat.css('top',h.top+b.conf.top-5)}};if(b.conf.set=='slideDown'){if(balance){b.mat.animate({height:'toggle',top:parseInt(b.mat.css('top'))-b.matHeight},{easing:'swing',duration:b.conf.setDuration}).css('opacity',b.conf.opacity)}else{b.mat.slideDown(b.conf.setDuration).css('opacity',b.conf.opacity)}}else if(b.conf.set=='fadeIn'){b.mat.css({display:'block',opacity:0}).fadeTo(b.conf.setDuration,b.conf.opacity)}else{b.mat.show().css('opacity',b.conf.opacity)};var d=isNaN(b.conf.setDuration)?null:b.conf.setDuration+10;if(d==null){if(b.conf.setDuration.match(/slow/)){interval=610}else if(b.conf.setDuration.match(/normal/)){interval=410}else{interval=210}};var e=setInterval(function(){a('a.selected',b.mat).focus();clearInterval(e)},d)};this.m_input.click(function(d){if(b.mat.is(':visible'))return false;set_pos();a(this).addClass('sctble_focus');a('a.sctble_display').not(this).removeClass('sctble_focus');mat_show();d.stopPropagation();return false}).keyup(function(d){if(c){set_pos();mat_show();d.stopPropagation()}else{c=true}});this.mat.click(function(d){d.stopPropagation()});a('body, a').not('a.sctble_display').click(function(d){a('a.sctble_display').removeClass('sctble_focus');mat_hide()}).not('a').keyup(function(d){if(d.keyCode=='27'){a('a.sctble_focus').removeClass('sctble_focus');c=false;b.m_input.blur();mat_hide()}});a('a',this.mat).click(function(){var d=a(this);b.m_text.text(decodeURI(d.attr('href').split('#')[1]));a('option[value="'+d.attr('name')+'"]',b.target).attr('selected','selected');a('.selected',b.mat).removeClass('selected');d.addClass('selected');b.m_input.removeClass('sctble_focus');c=false;mat_hide();if(b.conf.callback&&typeof b.conf.callback=='function'){b.conf.callback.call(b.target)};b.m_input.focus();return false});a('label[for="'+this.attrs.id+'"]').click(function(d){set_pos();b.m_input.addClass('sctble_focus');a('a.sctble_focus').not(b.m_input).removeClass('sctble_focus');mat_show();d.stopPropagation();return false})}};a.fn.jQselectable=function(b,c){if(a(this).length>1){var d=[];a(this).each(function(e){d[e]=new jQselectable(this,b,c)});return d}else{return new jQselectable(this,b,c)}};if(!jQuery.fn.selectable){a.fn.selectable=a.fn.jQselectable}})(jQuery);