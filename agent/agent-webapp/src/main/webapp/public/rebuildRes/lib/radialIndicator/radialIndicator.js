(function(factory){var global=Function("return this")()||(42,eval)("this");if(typeof define==="function"&&define.amd){define(["jquery"],function($){return(global.radialIndicator=factory($,global))})}else{if(typeof module==="object"&&module.exports){module.exports=global.document?factory(require("jquery"),global):function(w){if(!w.document){throw new Error("radialIndiactor requires a window with a document")}return factory(require("jquery")(w),w)}}else{global.radialIndicator=factory(global.jQuery,global)}}}(function($,window,undefined){var document=window.document;"use strict";var circ=Math.PI*2,quart=Math.PI/2;var smoothCanvas=(function(){var ctx=document.createElement("canvas").getContext("2d"),dpr=window.devicePixelRatio||1,bsr=ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1,ratio=dpr/bsr;return function(w,h,canvasElm){var can=canvasElm||document.createElement("canvas");can.width=w*ratio;can.height=h*ratio;can.style.width=w+"px";can.style.height=h+"px";can.getContext("2d").setTransform(ratio,0,0,ratio,0,0);return can}}());function hexToRgb(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16)]:null}function getPropVal(curShift,perShift,bottomRange,topRange){return Math.round(bottomRange+((topRange-bottomRange)*curShift/perShift))}function getCurrentColor(curPer,bottomVal,topVal,bottomColor,topColor){var rgbAryTop=topColor.indexOf("#")!=-1?hexToRgb(topColor):topColor.match(/\d+/g),rgbAryBottom=bottomColor.indexOf("#")!=-1?hexToRgb(bottomColor):bottomColor.match(/\d+/g),perShift=topVal-bottomVal,curShift=curPer-bottomVal;if(!rgbAryTop||!rgbAryBottom){return null}return"rgb("+getPropVal(curShift,perShift,rgbAryBottom[0],rgbAryTop[0])+","+getPropVal(curShift,perShift,rgbAryBottom[1],rgbAryTop[1])+","+getPropVal(curShift,perShift,rgbAryBottom[2],rgbAryTop[2])+")"}function merge(){var arg=arguments,target=arg[0];for(var i=1,ln=arg.length;i<ln;i++){var obj=arg[i];for(var k in obj){if(obj.hasOwnProperty(k)){target[k]=obj[k]}}}return target}function formatter(pattern){return function(num){if(!pattern){return num.toString()}num=num||0;var numRev=num.toString().split("").reverse(),output=pattern.split("").reverse(),i=0,lastHashReplaced=0;for(var ln=output.length;i<ln;i++){if(!numRev.length){break}if(output[i]=="#"){lastHashReplaced=i;output[i]=numRev.shift()}}output.splice(lastHashReplaced+1,output.lastIndexOf("#")-lastHashReplaced,numRev.reverse().join(""));return output.reverse().join("")}}function Indicator(container,indOption){var self=this;indOption=indOption||{};indOption=merge({},radialIndicator.defaults,indOption);this.indOption=indOption;if(typeof container=="string"){container=document.querySelector(container)}if(container.length){container=container[0]}this.container=container;var canElm=document.createElement("canvas");container.appendChild(canElm);this.canElm=canElm;this.ctx=canElm.getContext("2d");this.current_value=indOption.initValue||indOption.minValue||0;var startListener=function(e){if(!indOption.interaction){return}var touchMove=e.type=="touchstart"?"touchmove":"mousemove",touchEnd=e.type=="touchstart"?"touchend":"mouseup",position=canElm.getBoundingClientRect(),cy=position.top+canElm.offsetHeight/2,cx=position.left+canElm.offsetWidth/2;var moveListener=function(e){e.preventDefault();var mx=e.clientX||e.touches[0].clientX,my=e.clientY||e.touches[0].clientY,radian=(circ+quart+Math.atan2((my-cy),(mx-cx)))%(circ+0.0175),radius=(indOption.radius-1+indOption.barWidth/2),circum=circ*radius,precision=indOption.precision!=null?indOption.precision:0,precisionNo=Math.pow(10,precision),val=Math.round(precisionNo*radian*radius*(indOption.maxValue-indOption.minValue)/circum)/precisionNo;self.value(val)};var endListener=function(){document.removeEventListener(touchMove,moveListener,false);document.removeEventListener(touchEnd,endListener,false)};document.addEventListener(touchMove,moveListener,false);document.addEventListener(touchEnd,endListener,false)};canElm.addEventListener("touchstart",startListener,false);canElm.addEventListener("mousedown",startListener,false);canElm.addEventListener("mousewheel",MouseWheelHandler,false);canElm.addEventListener("DOMMouseScroll",MouseWheelHandler,false);function MouseWheelHandler(e){if(!indOption.interaction){return}e.preventDefault();var delta=-(Math.max(-1,Math.min(1,(e.wheelDelta||-e.detail)))),precision=indOption.precision!=null?indOption.precision:0,precisionNo=Math.pow(10,precision),diff=indOption.maxValue-indOption.minValue,val=self.current_value+Math.round(precisionNo*delta*diff/Math.min(diff,100))/precisionNo;self.value(val);return false}}Indicator.prototype={constructor:radialIndicator,_init:function(){var indOption=this.indOption,canElm=this.canElm,ctx=this.ctx,dim=(indOption.radius+indOption.barWidth)*2;
    this.formatter=typeof indOption.format=="function"?indOption.format:formatter(indOption.format);this.maxLength=indOption.percentage?4:this.formatter(indOption.maxValue).length;smoothCanvas(dim,dim,canElm);this._drawBarBg();this.value(this.current_value);return this},_drawBarBg:function(){var indOption=this.indOption,ctx=this.ctx,dim=(indOption.radius+indOption.barWidth)*2,center=dim/2;ctx.strokeStyle=indOption.barBgColor;ctx.lineWidth=indOption.barWidth;if(indOption.barBgColor!="transparent"){ctx.beginPath();ctx.arc(center,center,indOption.radius-1+indOption.barWidth/2,0,2*Math.PI);ctx.stroke()}},value:function(val){if(val===undefined||isNaN(val)){return this.current_value}val=parseFloat(val);var ctx=this.ctx,indOption=this.indOption,curColor=indOption.barColor,dim=(indOption.radius+indOption.barWidth)*2,minVal=indOption.minValue,maxVal=indOption.maxValue,center=dim/2;val=val<minVal?minVal:val;var precision=indOption.precision!=null?indOption.precision:0,precisionNo=Math.pow(10,precision),perVal=Math.round(((val-minVal)*precisionNo/(maxVal-minVal))*100)/precisionNo,dispVal=indOption.percentage?perVal+"%":this.formatter(val);this.current_value=val;ctx.clearRect(0,0,dim,dim);this._drawBarBg();if(typeof curColor=="object"){var range=Object.keys(curColor);for(var i=1,ln=range.length;i<ln;i++){var bottomVal=range[i-1],topVal=range[i],bottomColor=curColor[bottomVal],topColor=curColor[topVal],newColor=val==bottomVal?bottomColor:val==topVal?topColor:val>bottomVal&&val<topVal?indOption.interpolate?getCurrentColor(val,bottomVal,topVal,bottomColor,topColor):topColor:false;if(newColor!=false){curColor=newColor;break}}}ctx.strokeStyle=curColor;if(indOption.roundCorner){ctx.lineCap="round"}ctx.beginPath();ctx.arc(center,center,indOption.radius-1+indOption.barWidth/2,-(quart),((circ)*perVal/100)-quart,false);ctx.stroke();if(indOption.displayNumber){var cFont=ctx.font.split(" "),weight=indOption.fontWeight,fontSize=indOption.fontSize||(dim/(this.maxLength-(Math.floor(this.maxLength*1.4/4)-1)));cFont=indOption.fontFamily||cFont[cFont.length-1];ctx.fillStyle=indOption.fontColor||curColor;ctx.font=weight+" "+fontSize+"px "+cFont;ctx.textAlign="center";ctx.textBaseline=indOption.textBaseline;ctx.fillText(dispVal,center,center)}indOption.onChange.call(this.container,val);return this},animate:function(val){var indOption=this.indOption,counter=this.current_value||indOption.minValue,self=this,minVal=indOption.minValue,maxVal=indOption.maxValue,frameNum=indOption.frameNum||(indOption.percentage?100:500),precision=indOption.precision!=null?indOption.precision:Math.ceil(Math.log(maxVal-minVal/frameNum)),precisionNo=Math.pow(10,precision),incBy=(maxVal-minVal)/frameNum;val=val<minVal?minVal:val>maxVal?maxVal:val;var back=val<counter;if(this.intvFunc){clearInterval(this.intvFunc)}this.intvFunc=setInterval(function(){if((!back&&counter>=val)||(back&&counter<=val)){if(self.current_value==counter){clearInterval(self.intvFunc);if(indOption.onAnimationComplete){indOption.onAnimationComplete(self.current_value)}return}else{counter=val}}self.value(counter);if(counter!=val){counter=Math.round((counter+(back?-incBy:incBy))*precisionNo)/precisionNo}},indOption.frameTime);return this},option:function(key,val){if(val===undefined){return this.option[key]}if(["radius","barWidth","barBgColor","format","maxValue","percentage"].indexOf(key)!=-1){this.indOption[key]=val;this._init().value(this.current_value)}this.indOption[key]=val}};function radialIndicator(container,options){var progObj=new Indicator(container,options);progObj._init();return progObj}radialIndicator.defaults={radius:50,barWidth:5,barBgColor:"#eeeeee",barColor:"#99CC33",format:null,frameTime:10,frameNum:null,fontColor:null,fontFamily:null,fontWeight:"bold",fontSize:null,textBaseline:"middle",interpolate:true,percentage:false,precision:null,displayNumber:true,roundCorner:false,minValue:0,maxValue:100,initValue:0,interaction:false,onChange:function(){}};window.radialIndicator=radialIndicator;if($){$.fn.radialIndicator=function(options){return this.each(function(){var newPCObj=radialIndicator(this,options);$.data(this,"radialIndicator",newPCObj)})}}return radialIndicator}));